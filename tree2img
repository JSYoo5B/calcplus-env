#!/usr/bin/env python3
import sys
import re
import graphviz

def parse_sexp(s):
    tokens = re.findall(r"\(|\)|[^\s()]+", s)
    def _parse():
        res = []
        while tokens:
            t = tokens.pop(0)
            if t == "(":
                res.append(_parse())
            elif t == ")":
                return res
            else:
                res.append(t)
        return res[0] if res else None
    return _parse()

def build_graph(dot, node, parent_id=None):
    if not node: return

    node_id = str(id(node))
    label = node[0] if isinstance(node, list) else node

    dot.node(node_id, label=label, shape='ellipse', fontname='Arial')

    if parent_id:
        dot.edge(parent_id, node_id)

    if isinstance(node, list):
        for child in node[1:]:
            build_graph(dot, child, node_id)

def main():
    input_data = sys.stdin.read().strip()
    if not input_data:
        print("Error: No input data received.")
        sys.exit(1)

    tree = parse_sexp(input_data)
    if not tree:
        print("Error: Failed to parse tree.")
        sys.exit(1)

    dot = graphviz.Digraph(format="png")
    dot.attr(rankdir='TB') # Top to Bottom
    build_graph(dot, tree)

    dot.render("tree", cleanup=True)
    print("Success: Tree visualization saved as 'tree.png'")

if __name__ == "__main__":
    main()